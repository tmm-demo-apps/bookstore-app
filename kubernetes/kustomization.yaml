apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Default namespace - Kustomize applies this to all resources
namespace: bookstore

# Resources to include (order matters for dependencies)
resources:
  - namespace.yaml
  # Note: secret.yaml is gitignored - secrets are managed separately via:
  #   kubectl create secret generic app-secrets --from-literal=...
  #   kubectl create secret docker-registry harbor-registry-secret --docker-server=...
  # See kubernetes/README.md for secret creation commands
  - configmap.yaml
  - postgres.yaml
  - redis.yaml
  - elasticsearch.yaml
  - minio.yaml
  - migrations-configmap.yaml
  - app.yaml
  - ingress.yaml
  - hpa.yaml
  # Note: init-db-job.yaml is a one-time job, apply separately after infrastructure is ready
  # Note: ingress-nginx.yaml deploys to ingress-nginx namespace, apply separately

# Image overrides - CI/CD updates the app tag only
images:
  - name: harbor.corp.vmbeans.com/bookstore/app
    newTag: 35ef55cb25b7c911b98355f33736e1938ba9f5af
  - name: harbor.corp.vmbeans.com/library/postgres
    newTag: 14-alpine
  - name: harbor.corp.vmbeans.com/library/redis
    newTag: 7-alpine
  - name: harbor.corp.vmbeans.com/library/elasticsearch
    newTag: 8.11.0
  - name: harbor.corp.vmbeans.com/library/minio/minio
    newTag: latest
